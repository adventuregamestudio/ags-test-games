// GfxComparer Comparer

static bool GfxComparer::MatchSprites(int sprite1, int sprite2)
{
  if(sprite1 == sprite2) return true;
  
  DynamicSprite* dynspr_1 = DynamicSprite.CreateFromExistingSprite(sprite1);
  DynamicSprite* dynspr_2 = DynamicSprite.CreateFromExistingSprite(sprite2);
  DrawingSurface* surf_1 = dynspr_1.GetDrawingSurface();
  DrawingSurface* surf_2 = dynspr_2.GetDrawingSurface();
  
  if(surf_1.Width != surf_2.Width || surf_1.Height != surf_2.Height) return false;
  
  
  for(int i=0; i<surf_1.Width; i++) {
    for(int j=0; j<surf_1.Height; j++) {
      if(surf_1.GetPixel(i, j) != surf_2.GetPixel(i, j)) return false;
    }
  }
  
  return true;
}

static bool GfxComparer::MatchSurfaceRects(DrawingSurface *test_ds, DrawingSurface *match_ds, 
  int rx, int ry, int rw, int rh)
{
  for (int y = 0; y < rh; y++) {
    for (int x = 0; x < rw; x++) {
      if (test_ds.GetPixel(x + rx, y + ry) != match_ds.GetPixel(x, y)) {
        return false;
      }
    }
  }
  
  return true;
}

static bool GfxComparer::TakeScreenshotAndMatchRect(int rx, int ry, int rw, int rh, DynamicSprite *match_with)
{
  DynamicSprite *shot = DynamicSprite.CreateFromScreenShot(Screen.Width, Screen.Height);
  DrawingSurface *test_ds = shot.GetDrawingSurface();
  DrawingSurface *match_ds = match_with.GetDrawingSurface();
  return GfxComparer.MatchSurfaceRects(test_ds, match_ds, rx, ry, rw, rh);
}

static bool GfxComparer::TakeScreenshotAndMatchRect2(int r1x, int r1y, int r1w, int r1h, DynamicSprite *match_with1, 
  int r2x, int r2y, int r2w, int r2h, DynamicSprite *match_with2)
{
  DynamicSprite *shot = DynamicSprite.CreateFromScreenShot(Screen.Width, Screen.Height);
  DrawingSurface *test_ds = shot.GetDrawingSurface();
  DrawingSurface *match_ds1 = match_with1.GetDrawingSurface();
  DrawingSurface *match_ds2 = match_with2.GetDrawingSurface();
  
  if (!GfxComparer.MatchSurfaceRects(test_ds, match_ds1, r1x, r1y, r1w, r1h)) {
    return false;
  }
  if (!GfxComparer.MatchSurfaceRects(test_ds, match_ds2, r2x, r2y, r2w, r2h)) {
    return false;
  }
  return true;
}

static bool GfxComparer::TakeScreenshotAndMatchSprite(int rx, int ry, int rw, int rh, int match_with_sprite, 
  eFlipDirection flip)
{
  DynamicSprite *spr_match = DynamicSprite.CreateFromExistingSprite(match_with_sprite, true);
  if (flip >= 0)
    spr_match.Flip(flip);
  return GfxComparer.TakeScreenshotAndMatchRect(rx, ry, rw, rh, spr_match);
}
