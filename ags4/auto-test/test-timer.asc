// Test Timers Module Script

int GetTestTimersCount()
{
  return 0
  + 9
  + 6 * 4
  ;
}

void TestTimers()
{
  tap.Comment("start Timers tests");
  int old_game_speed = Game.Speed;
  Game.Speed = 1000;
  
  // Basic timer mechanics
  tap.is_int(IsTimerExpired(1), false, "IsTimerExpired, pre-launch");
  tap.is_int(GetTimerPos(1), 0, "GetTimerPos, pre-launch");
  SetTimer(1, 100);
  tap.is_int(IsTimerExpired(1), false, "IsTimerExpired, at launch");
  tap.is_int(GetTimerPos(1), 100, "GetTimerPos, at launch");
  Wait(50);
  tap.is_int(IsTimerExpired(1), false, "IsTimerExpired, middle run");
  tap.is_int(GetTimerPos(1), 50, "GetTimerPos, middle run");
  Wait(49);
  tap.is_int(GetTimerPos(1), 1, "GetTimerPos, end of run");
  tap.is_int(IsTimerExpired(1), true, "IsTimerExpired, end of run");
  tap.is_int(IsTimerExpired(1), false, "IsTimerExpired, post run");
  
  // Several timers showing different positions
  SetTimer(1, 10);
  SetTimer(4, 40);
  SetTimer(8, 80);
  SetTimer(10, 100);
  Wait(5);
  tap.is_int(GetTimerPos(1), 5, "GetTimerPos (1), position test 1");
  tap.is_int(GetTimerPos(4), 35, "GetTimerPos (4), position test 1");
  tap.is_int(GetTimerPos(8), 75, "GetTimerPos (8), position test 1");
  tap.is_int(GetTimerPos(10), 95, "GetTimerPos (10), position test 1");
  Wait(25);
  // NOTE: expired timers will be stuck at pos 1 until IsTimerExpired is called
  tap.is_int(GetTimerPos(1), 1, "GetTimerPos (1), position test 2");
  tap.is_int(GetTimerPos(4), 10, "GetTimerPos (4), position test 2");
  tap.is_int(GetTimerPos(8), 50, "GetTimerPos (8), position test 2");
  tap.is_int(GetTimerPos(10), 70, "GetTimerPos (10), position test 2");
  Wait(25);
  tap.is_int(GetTimerPos(1), 1, "GetTimerPos (1), position test 3");
  tap.is_int(GetTimerPos(4), 1, "GetTimerPos (4), position test 3");
  tap.is_int(GetTimerPos(8), 25, "GetTimerPos (8), position test 3");
  tap.is_int(GetTimerPos(10), 45, "GetTimerPos (10), position test 3");
  Wait(25);
  tap.is_int(GetTimerPos(1), 1, "GetTimerPos (1), position test 4");
  tap.is_int(GetTimerPos(4), 1, "GetTimerPos (4), position test 4");
  tap.is_int(GetTimerPos(8), 1, "GetTimerPos (8), position test 4");
  tap.is_int(GetTimerPos(10), 20, "GetTimerPos (10), position test 4");
  Wait(19);
  tap.is_int(GetTimerPos(1), 1, "GetTimerPos (1), position test 5");
  tap.is_int(GetTimerPos(4), 1, "GetTimerPos (4), position test 5");
  tap.is_int(GetTimerPos(8), 1, "GetTimerPos (8), position test 5");
  tap.is_int(GetTimerPos(10), 1, "GetTimerPos (10), position test 5");
  tap.is_int(IsTimerExpired(1), true, "IsTimerExpired (1)");
  tap.is_int(IsTimerExpired(4), true, "IsTimerExpired (4)");
  tap.is_int(IsTimerExpired(8), true, "IsTimerExpired (8)");
  tap.is_int(IsTimerExpired(10), true, "IsTimerExpired (10)");
  
  Game.Speed = old_game_speed;
  tap.Comment("end Timers tests");
}
