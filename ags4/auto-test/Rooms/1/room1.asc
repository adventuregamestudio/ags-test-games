// room script file
// Room1.asc
//
// This room runs the stage 1 tests

bool Stage1TestsDone;
function room_AfterFadeIn()
{
  BeginTests();
  RunStage1Tests();
  Stage1TestsDone = true;
}

int DelayedTestGroup;
int DelayedTestCounter;

void RunDelayedTests()
{
  int was_test_counter = DelayedTestCounter;
  DelayedTestCounter = RunStage1DelayedTests(DelayedTestGroup, DelayedTestCounter);
  if (DelayedTestCounter < 0)
  {
    if (was_test_counter != 0)
    {
      DelayedTestGroup++;
      DelayedTestCounter = 0;
    }
    else
    {
      FinishTests();
    }
  }
}

// Delayed tests require non-blocking game state
function room_RepExec()
{
  if (!Stage1TestsDone)
    return;
  
  // This is a temporary hack: GUI tests cannot be triggered by RepExec, 
  // because in AGS 4.0 it now runs *after* the game (gui) update but before drawing, 
  // so we must use rep-exec-always instead to set up mouse position.
  if (DelayedTestGroup != STAGE1_DELAYED_GROUP_GUILOOKS)
  {
    RunDelayedTests();
  }
}

function repeatedly_execute_always()
{
  // Delayed tests require non-blocking game state
  if (!Stage1TestsDone || Game.InBlockingAction)
    return;

  // This is a temporary hack: GUI tests cannot be triggered by RepExec, 
  // because in AGS 4.0 it now runs *after* the game (gui) update but before drawing, 
  // so we must use rep-exec-always instead to set up mouse position.
  if (DelayedTestGroup == STAGE1_DELAYED_GROUP_GUILOOKS)
  {
    RunDelayedTests();
  }
}

//---------------------------------------------------------------
// Interaction events for tests
//---------------------------------------------------------------

function oInteractive_AnyClick(Object *theObject, CursorMode mode)
{
  LastAnyClickInteraction = "Object.AnyClick";
}

function oInteractive_Interact(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Interact";
}

function oInteractive_Look(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Lookat";
}

function oInteractive_PickUp(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Pickup";
}

function oInteractive_Talk(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Talkto";
}

function oInteractive_UseInv(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Useinv";
}

function oInteractive_Mode8(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Mode8";
}

function oInteractive_Mode9(Object *theObject, CursorMode mode)
{
  LastInteraction = "Object.Mode9";
}

function oAnyClicker_AnyClick(Object *theObject, CursorMode mode)
{
  LastAnyClickInteraction = "Object.AnyClick";
}

function hInteractive_AnyClick(Hotspot *theHotspot, CursorMode mode)
{
  LastAnyClickInteraction = "Hotspot.AnyClick";
}

function hInteractive_Interact(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Interact";
}

function hInteractive_Look(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Lookat";
}

function hInteractive_MouseMove(Hotspot *theHotspot)
{
  LastInteraction = "Hotspot.MouseMove";
}

function hInteractive_PickUp(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Pickup";
}

function hInteractive_WalkOn(Hotspot *theHotspot)
{
  LastInteraction = "Hotspot.WalkOn";
}

function hInteractive_Talk(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Talkto";
}

function hInteractive_UseInv(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Useinv";
}

function hInteractive_Mode8(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Mode8";
}

function hInteractive_Mode9(Hotspot *theHotspot, CursorMode mode)
{
  LastInteraction = "Hotspot.Mode9";
}

function hAnyClicker_AnyClick(Hotspot *theHotspot, CursorMode mode)
{
  LastAnyClickInteraction = "Hotspot.AnyClick";
}

function region1_WalksOff(Region *theRegion)
{
  LastInteraction = "Region.WalkOff";
}

function region1_WalksOnto(Region *theRegion)
{
  LastInteraction = "Region.WalkOn";
}

function region1_Standing(Region *theRegion)
{
  LastInteraction = "Region.StandOn";
}