// new module script

int TotalTestCount;

void BeginTests()
{
  int test_count = 0;
  test_count += GetTestMathsCount();
  test_count += GetTestStringCount();
  test_count += GetTestSetCount();
  test_count += GetTestDictionaryCount();
  test_count += GetTestParserCount();
  test_count += GetTestFileCount();
  test_count += GetTestDrawingSurfaceCount();
  test_count += GetTestObjectAccessCount();
  test_count += GetTestDialogPropertiesCount();
  test_count += GetTestGUIPropertiesCount();
  test_count += GetTestMiscCount();
  test_count += GetTestObjectsCount();
  test_count += GetTestCharactersCount();
  test_count += GetTestOverlaysCount();
  test_count += GetTestTimersCount();
  test_count += GetTestInteractionsCount();
  test_count += GetTestPathfindingCount();
  test_count += GetTestEngineRenderCount();
  test_count += GetTestAudioCount();
  
  TotalTestCount = test_count;
  
  tap.clean_test();
  tap.Comment(String.Format("Running AGS engine %s", System.GetEngineString(ENGINE_VALUE_S_ENGINE_VERSION_FULL)));
  tap.plan(test_count);
}

void FinishTests()
{
  tap.done_testing();
  
  if (tap.AnyTestFailed()) {
    AbortGame("ERROR: test(s) have failed.");
  }
  
  if (tap.PlannedTests != tap.ExecutedTests) {
    AbortGame("ERROR: Plan mismatch! Planned %d tests, but ran %d tests.", tap.PlannedTests, tap.ExecutedTests);
  }
  
  QuitGame(0);
}

void RunStage1Tests()
{
  TestString();
  TestMaths();
  TestSet();
  TestDictionary();
  TestParser();
  TestFile();
  TestDrawingSurface();
  TestObjectAccess();
  TestDialogProperties();
  TestGUIProperties();
  TestMisc();
  TestObjects();
  TestCharacters();
  TestOverlays();
  TestTimers();
  TestPathfinding();
  TestEngineRender();
  TestAudio();
}

int RunStage1DelayedTests(int counter)
{
  // Can add more different tests here, depending on "counter" value.
  // Even counter values (0 and onward) are case runs, and odd values are post-case checks.
  // So total counter increments = number of tests * 2.
  counter = TestInteractions(counter);
  return counter;
}
