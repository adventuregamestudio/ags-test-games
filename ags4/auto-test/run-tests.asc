
int TotalTestCount;

void BeginTests()
{
  int test_count = 0;
  test_count += GetTestMathsCount();
  test_count += GetTestStringCount();
  test_count += GetTestSetCount();
  test_count += GetTestDictionaryCount();
  test_count += GetTestParserCount();
  test_count += GetTestFileCount();
  test_count += GetTestDrawingSurfaceCount();
  test_count += GetTestObjectAccessCount();
  test_count += GetTestDialogPropertiesCount();
  test_count += GetTestGUIPropertiesCount();
  test_count += GetTestGUILooksCount();
  test_count += GetTestMiscCount();
  test_count += GetTestObjectsCount();
  test_count += GetTestCharactersCount();
  test_count += GetTestOverlaysCount();
  test_count += GetTestTimersCount();
  test_count += GetTestInteractionsCount();
  test_count += GetTestPathfindingCount();
  test_count += GetTestEngineRenderCount();
  test_count += GetTestAudioCount();
  
  TotalTestCount = test_count;
  
  // IMPORTANT: tap.plan() must be the first call prior to any other output, 
  // this is required by the tap results parser.
  tap.clean_test();
  tap.plan(test_count);
  
  tap.Comment(String.Format("Running AGS engine %s", System.GetEngineString(ENGINE_VALUE_S_ENGINE_VERSION_FULL)));
}

void FinishTests()
{
  tap.done_testing();
  
  if (tap.AnyTestFailed()) {
    AbortGame("ERROR: test(s) have failed.");
  }
  
  if (tap.PlannedTests != tap.ExecutedTests) {
    AbortGame("ERROR: Plan mismatch! Planned %d tests, but ran %d tests.", tap.PlannedTests, tap.ExecutedTests);
  }
  
  QuitGame(0);
}

void RunStage1Tests()
{
  TestString();
  TestMaths();
  TestSet();
  TestDictionary();
  TestParser();
  TestFile();
  TestDrawingSurface();
  TestObjectAccess();
  TestDialogProperties();
  TestGUIProperties();
  TestGUILooks();
  TestMisc();
  TestObjects();
  TestCharacters();
  TestOverlays();
  TestTimers();
  TestPathfinding();
  TestEngineRender();
  TestAudio();
}

int RunStage1DelayedTests(int test_group, int test_counter)
{
  // Can add more different tests here, depending on "test_group" value.
  if (test_group == STAGE1_DELAYED_GROUP_INTERACTIONS)
  {
    return TestInteractions(test_counter);
  }
  else if (test_group == STAGE1_DELAYED_GROUP_GUILOOKS)
  {
    return TestGUILooksDelayed(test_counter);
  }
  else
  {
    return -1;
  }
}
